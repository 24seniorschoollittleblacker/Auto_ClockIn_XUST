# This workflows will upload a Python Package using Twine when a release is created
# For more information see: https://help.github.com/en/actions/language-and-framework-guides/using-python-with-github-actions#publishing-to-package-registries

name: 运行

on:
  # Trigger the workflow on push or pull request,
  # but only for the main branch
  push:
    branches:
      - main
  schedule:
    - cron: '10 3 * * *'
    - cron: '10 11 * * *'

    
jobs:
  TEST:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
        
    - name: 配置用户信息(必须先配置secrets)并生成配置文件config.json
      run: |
        echo "尝试读取secrets(config)"
        string='${{ secrets.config }}'
        if [ -z "$string" ]; then
        echo "secrets(config)未填写"
        exit -1
        fi
        array=(${string})
        sed -i "s/user/${array[0]}/g" ./config/config.json
        sed -i "s/password/${array[1]}/g" ./config/config.json
        sed -i "s/SERVERPUSHKEY/${array[2]}/g" ./config/config.json
        echo "成功用secrets(config)生成配置文件config.json"
        cat ./config/config.json
      
